!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).TweakpaneImagePlugin={})}(this,(function(e){"use strict";const t="tp";function i(e){return t=>i=>{if(!t&&void 0===i)return{succeeded:!1,value:void 0};if(t&&void 0===i)return{succeeded:!0,value:void 0};const n=e(i);return void 0!==n?{succeeded:!0,value:n}:{succeeded:!1,value:void 0}}}function n(e){return{custom:t=>i(t)(e),boolean:i((e=>"boolean"==typeof e?e:void 0))(e),number:i((e=>"number"==typeof e?e:void 0))(e),string:i((e=>"string"==typeof e?e:void 0))(e),function:i((e=>"function"==typeof e?e:void 0))(e),constant:t=>i((e=>e===t?t:void 0))(e),raw:i((e=>e))(e),object:t=>i((e=>{var i;if(null!==(i=e)&&"object"==typeof i)return function(e,t){return Object.keys(t).reduce(((i,n)=>{if(void 0===i)return;const a=(0,t[n])(e[n]);return a.succeeded?Object.assign(Object.assign({},i),{[n]:a.value}):void 0}),{})}(e,t)}))(e),array:t=>i((e=>{var i;if(Array.isArray(e))return i=t,e.reduce(((e,t)=>{if(void 0===e)return;const n=i(t);return n.succeeded&&void 0!==n.value?[...e,n.value]:void 0}),[])}))(e)}}const a={optional:n(!0),required:n(!1)};function o(e,t,i,n){return new(i||(i=Promise))((function(a,o){function r(e){try{l(n.next(e))}catch(e){o(e)}}function s(e){try{l(n.throw(e))}catch(e){o(e)}}function l(e){var t;e.done?a(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(r,s)}l((n=n.apply(e,t||[])).next())}))}function r(e){return o(this,void 0,void 0,(function*(){const t=new Image;return t.crossOrigin="anonymous",new Promise((i=>{t.src=e,t.onload=()=>{i(t)}}))}))}function s(e){const t=document.createElement("canvas");t.width=e.width,t.height=e.height;t.getContext("2d").drawImage(e,0,0);const i=new Image;return new Promise((e=>{t.toBlob((t=>{i.src=URL.createObjectURL(t),i.onload=()=>{e(i)}}))}))}const l=(d="img",(e,i)=>[t,"-",d,"v",e?`_${e}`:"",i?`-${i}`:""].join(""));var d;class c{constructor(e,t){this.element=e.createElement("div"),this.element.classList.add(l()),t.viewProps.bindClassModifiers(this.element),this.input=e.createElement("input"),this.input.classList.add(l("input")),this.input.setAttribute("type","file"),this.input.setAttribute("accept",t.extensions.join(",")),this.element.appendChild(this.input),this.image_=e.createElement("img"),this.image_.classList.add(l("image")),this.image_.classList.add(l(`image_${t.imageFit}`)),this.element.classList.add(l("area_root")),this.element.appendChild(this.image_)}changeImage(e){this.image_.src=e}changeDraggingState(e){const t=this.element;e?null==t||t.classList.add(l("area_dragging")):null==t||t.classList.remove(l("area_dragging"))}}class h{constructor(e,t){this.placeholderImage=null,this.value=t.value,this.viewProps=t.viewProps,this.view=new c(e,{viewProps:this.viewProps,extensions:t.extensions,imageFit:t.imageFit}),this.onFile=this.onFile.bind(this),this.onDrop=this.onDrop.bind(this),this.onDragOver=this.onDragOver.bind(this),this.onDragLeave=this.onDragLeave.bind(this),this.view.input.addEventListener("change",this.onFile),this.view.element.addEventListener("drop",this.onDrop),this.view.element.addEventListener("dragover",this.onDragOver),this.view.element.addEventListener("dragleave",this.onDragLeave),this.viewProps.handleDispose((()=>{this.view.input.removeEventListener("change",this.onFile),this.view.input.removeEventListener("drop",this.onDrop),this.view.input.removeEventListener("dragover",this.onDragOver),this.view.input.removeEventListener("dragleave",this.onDragLeave)})),this.value.emitter.on("change",this.handleValueChange.bind(this)),this.handleValueChange()}onFile(e){const t=(null==e?void 0:e.target).files;if(!t||!t.length)return;const i=t[0],n=URL.createObjectURL(i);this.setValue(n),this.updateImage(n)}onDrop(e){return o(this,void 0,void 0,(function*(){e.preventDefault();try{const{dataTransfer:t}=e,i=null==t?void 0:t.files[0];if(i){const e=URL.createObjectURL(i);this.updateImage(e),this.setValue(e)}else{const e=null==t?void 0:t.getData("url");if(!e)throw new Error("No url");r(e).then((e=>o(this,void 0,void 0,(function*(){const t=yield s(e);this.updateImage(t.src),this.setValue(t)}))))}}catch(e){console.error("Could not parse the dropped image",e)}finally{this.view.changeDraggingState(!1)}}))}onDragOver(e){e.preventDefault(),this.view.changeDraggingState(!0)}onDragLeave(){this.view.changeDraggingState(!1)}handleImage(e){return o(this,void 0,void 0,(function*(){if(e instanceof HTMLImageElement)s(e).then((e=>{this.updateImage(e.src)}));else if("string"==typeof e){let t="";try{if("placeholder"===e)throw new Error("placeholder");new URL(e);t=(yield r(e)).src}catch(e){t=(yield this.handlePlaceholderImage()).src}finally{this.updateImage(t),this.setValue(t)}}}))}updateImage(e){this.view.changeImage(e)}setValue(e){return o(this,void 0,void 0,(function*(){e instanceof HTMLImageElement?this.value.setRawValue(e):e?this.value.setRawValue(yield r(e)):this.value.setRawValue(yield this.handlePlaceholderImage())}))}handleValueChange(){this.handleImage(this.value.rawValue)}handlePlaceholderImage(){return o(this,void 0,void 0,(function*(){return this.placeholderImage||(this.placeholderImage=yield function(){const e=document.createElement("canvas");e.width=128,e.height=64;const t=e.getContext("2d");return t.fillStyle="#222",t.fillRect(0,0,e.width,e.height),t.fillStyle="#ddd",t.font="monospaced",t.textAlign="center",t.textBaseline="middle",t.fillText("No image",.5*e.width,.5*e.height),new Promise((t=>{e.toBlob((e=>{const i=new Image;i.src=URL.createObjectURL(e),i.onload=()=>{t(i)}}))}))}()),this.placeholderImage}))}}const u=[".jpg",".png",".gif"],g={id:"input-image",type:"input",css:".tp-imgv{-webkit-appearance:none;-moz-appearance:none;appearance:none;background-color:transparent;border-width:0;font-family:inherit;font-size:inherit;font-weight:inherit;margin:0;outline:none;padding:0}.tp-imgv{background-color:var(--in-bg);border-radius:var(--elm-br);box-sizing:border-box;color:var(--in-fg);font-family:inherit;height:var(--bld-us);line-height:var(--bld-us);min-width:0;width:100%}.tp-imgv:hover{background-color:var(--in-bg-h)}.tp-imgv:focus{background-color:var(--in-bg-f)}.tp-imgv:active{background-color:var(--in-bg-a)}.tp-imgv:disabled{opacity:0.5}:root{--tp-plugin-image-dragging-color: hsla(230, 100%, 66%, 1.00)}.tp-imgv{cursor:pointer;display:grid;height:calc(var(--bld-us) * 3);overflow:hidden;position:relative}.tp-imgv.tp-v-disabled{opacity:0.5}.tp-imgv_input{width:100%;height:100%;opacity:0}.tp-imgv_image{width:100%;height:100%;position:absolute;pointer-events:none;border:0}.tp-imgv_image_contain{-o-object-fit:contain;object-fit:contain}.tp-imgv_image_cover{-o-object-fit:cover;object-fit:cover}.tp-imgv_area_root{transition:opacity 0.16s ease-in-out}.tp-imgv_area_dragging{border:2px dashed var(--tp-plugin-image-dragging-color);border-radius:6px;opacity:0.6}",accept(e,t){if(!(e instanceof HTMLImageElement||"string"==typeof e))return null;const i=a,n=function(e,t){const i=a.required.object(t)(e);return i.succeeded?i.value:void 0}(t,{view:i.required.constant("input-image"),acceptUrl:i.optional.boolean,imageFit:i.optional.custom((e=>"contain"===e||"cover"===e?e:void 0)),extensions:i.optional.array(i.required.string)});return n?{initialValue:e,params:n}:null},binding:{reader:e=>e=>e instanceof HTMLImageElement?""===e.src?"placeholder":e.src:"string"==typeof e?e:"placeholder",writer:e=>(e,t)=>{e.write(t)}},controller(e){var t,i;return new h(e.document,{value:e.value,imageFit:null!==(t=e.params.imageFit)&&void 0!==t?t:"cover",viewProps:e.viewProps,extensions:null!==(i=e.params.extensions)&&void 0!==i?i:u})}};e.plugin=g,Object.defineProperty(e,"__esModule",{value:!0})}));
